// Copyright 2024 Tencent Inc. All rights reserved.
//

#include "inc/writer_wheel.h"
#include "car.pb.h"
#include "inc/proto_helper.h"

WheelTireParamWriter::WheelTireParamWriter() {}

void WheelTireParamWriter::fillWheelTire(tx_car::car &m_car) {
  auto *tire = m_car.mutable_wheel_tire()->mutable_tire();

  tx_car::setStringScalar(tire->mutable_tno_tir_path(), "TNO_tir", "TNO tir path", "CS_car225_60R18.tir");
  tx_car::setRealScalar(tire->mutable_wheel_radius(), "wheel radius", "wheel radius", "m", 0.364);
}

void WheelTireParamWriter::fillBrake(tx_car::car &m_car) {
  tx_car::BrakeDD *brake = m_car.mutable_wheel_tire()->mutable_brake();

  tx_car::setRealScalar(brake->mutable_mu_static(), "MU_Static", "Static friction coefficient", "[]", 0.4);
  tx_car::setRealScalar(brake->mutable_mu_kinetic(), "MU_Kinetic", "Kinetic friction coefficient", "[]", 0.34);

  real_T brakeMapPressure[] = {1.0,
                               11.4736842105263,
                               21.9473684210526,
                               32.4210526315789,
                               42.8947368421053,
                               53.3684210526316,
                               63.8421052631579,
                               74.3157894736842,
                               84.7894736842105,
                               95.2631578947368,
                               105.736842105263,
                               116.210526315789,
                               126.684210526316,
                               137.157894736842,
                               147.631578947368,
                               158.105263157895,
                               168.578947368421,
                               179.052631578947,
                               189.526315789474};  // unit bar

  real_T brakeMapWheelSpeed[] = {0.0,
                                 52.6315789473684,
                                 105.263157894737,
                                 157.894736842105,
                                 210.526315789474,
                                 263.157894736842,
                                 315.789473684211,
                                 368.421052631579,
                                 421.052631578947,
                                 473.684210526316,
                                 526.315789473684,
                                 578.947368421053,
                                 631.578947368421,
                                 684.210526315789,
                                 736.842105263158,
                                 789.473684210526,
                                 842.105263157895,
                                 894.736842105263,
                                 947.368421052632,
                                 1000.0};  // unit rpm

  real_T brakeMapData[] = {
      43.4900602404453, 498.991217495636, 954.492374750826, 1409.99353200602, 1865.49468926121, 2320.9958465164,
      2776.49700377159, 3231.99816102678, 3687.49931828197, 4143.00047553716, 4598.50163279235, 5054.00279004754,
      5509.50394730273, 5965.00510455792, 6420.50626181311, 6876.0074190683,  7331.50857632349, 7787.00973357868,
      8242.51089083387, 42.5056030554862, 487.695866636631, 932.886130217776, 1378.07639379892, 1823.26665738007,
      2268.45692096121, 2713.64718454235, 3158.8374481235,  3604.02771170464, 4049.21797528579, 4494.40823886693,
      4939.59850244808, 5384.78876602923, 5829.97902961037, 6275.16929319151, 6720.35955677266, 7165.5498203538,
      7610.74008393495, 8055.93034751609, 41.5350898940194, 476.560505099801, 911.585920305583, 1346.61133551136,
      1781.63675071715, 2216.66216592293, 2651.68758112871, 3086.71299633449, 3521.73841154027, 3956.76382674606,
      4391.78924195184, 4826.81465715762, 5261.8400723634,  5696.86548756918, 6131.89090277496, 6566.91631798075,
      7001.94173318653, 7436.96714839231, 7871.99256359809, 40.5780454442085, 465.579679307235, 890.581313170261,
      1315.58294703329, 1740.58458089631, 2165.58621475934, 2590.58784862237, 3015.58948248539, 3440.59111634842,
      3865.59275021144, 4290.59438407447, 4715.59601793749, 5140.59765180052, 5565.59928566355, 5990.60091952657,
      6415.6025533896,  6840.60418725262, 7265.60582111565, 7690.60745497868, 39.6340111501808, 454.748127933653,
      869.862244717126, 1284.9763615006,  1700.09047828407, 2115.20459506754, 2530.31871185102, 2945.43282863449,
      3360.54694541796, 3775.66106220143, 4190.77517898491, 4605.88929576838, 5021.00341255185, 5436.11752933532,
      5851.23164611879, 6266.34576290227, 6681.45987968574, 7096.57399646921, 7511.68811325269, 38.7025443887544,
      444.060772460445, 849.419000532136, 1254.77722860383, 1660.13545667552, 2065.49368474721, 2470.8519128189,
      2876.21014089059, 3281.56836896228, 3686.92659703397, 4092.28482510566, 4497.64305317735, 4903.00128124905,
      5308.35950932074, 5713.71773739243, 6119.07596546412, 6524.43419353581, 6929.7924216075,  7335.15064967919,
      37.7832176914519, 433.51270824929,  829.242198807128, 1224.97168936497, 1620.7011799228,  2016.43067048064,
      2412.16016103848, 2807.88965159632, 3203.61914215416, 3599.34863271199, 3995.07812326983, 4390.80761382767,
      4786.53710438551, 5182.26659494335, 5577.99608550118, 5973.72557605903, 6369.45506661686, 6765.1845571747,
      7160.91404773254, 36.8756180088306, 423.099196101319, 809.322774193808, 1195.5463522863,  1581.76993037878,
      1967.99350847127, 2354.21708656376, 2740.44066465625, 3126.66424274874, 3512.88782084123, 3899.11139893372,
      4285.3349770262,  4671.5585551187,  5057.78213321118, 5444.00571130367, 5830.22928939616, 6216.45286748865,
      6602.67644558114, 6988.90002367363, 35.9793460143796, 412.81565427025,  789.651962526121, 1166.48827078199,
      1543.32457903786, 1920.16088729373, 2296.9971955496,  2673.83350380547, 3050.66981206134, 3427.50612031721,
      3804.34242857308, 4181.17873682896, 4558.01504508483, 4934.8513533407,  5311.68766159656, 5688.52396985244,
      6065.36027810831, 6442.19658636418, 6819.03289462005, 35.0940154454303, 402.657650900201, 770.221286354971,
      1137.78492180974, 1505.34855726451, 1872.91219271928, 2240.47582817405, 2608.03946362882, 2975.60309908359,
      3343.16673453836, 3710.73036999313, 4078.2940054479,  4445.85764090267, 4813.42127635744, 5180.98491181221,
      5548.54854726698, 5916.11218272175, 6283.67581817653, 6651.2394536313,  34.2192524787115, 392.620896861006,
      751.0225412433,   1109.42418562559, 1467.82583000789, 1826.22747439018, 2184.62911877248, 2543.03076315477,
      2901.43240753707, 3259.83405191936, 3618.23569630166, 3976.63734068395, 4335.03898506625, 4693.44062944854,
      5051.84227383083, 5410.24391821313, 5768.64556259542, 6127.04720697772, 6485.44885136001, 33.3546951383474,
      382.701238955775, 732.047782773203, 1081.39432659063, 1430.74087040806, 1780.08741422549, 2129.43395804292,
      2478.78050186034, 2828.12704567777, 3177.4735894952,  3526.82013331263, 3876.16667713006, 4225.51322094748,
      4574.85976476491, 4924.20630858234, 5273.55285239977, 5622.8993962172,  5972.24594003463, 6321.59248385205,
      32.4999927342521, 372.894653477208, 713.289314220164, 1053.68397496312, 1394.07863570608, 1734.47329644903,
      2074.86795719199, 2415.26261793494, 2755.6572786779,  3096.05193942085, 3436.44660016381, 3776.84126090677,
      4117.23592164972, 4457.63058239268, 4798.02524313563, 5138.41990387859, 5478.81456462154, 5819.2092253645,
      6159.60388610746, 31.6548053290159, 363.197240090814, 694.739674852612, 1026.28210961441, 1357.82454437621,
      1689.36697913801, 2020.9094138998,  2352.4518486616,  2683.9942834234,  3015.5367181852,  3347.079152947,
      3678.62158770879, 4010.16402247059, 4341.70645723239, 4673.24889199419, 5004.79132675599, 5336.33376151778,
      5667.87619627958, 5999.41863104138, 30.8188032315107, 353.605216024701, 676.391628817892, 999.178041611083,
      1321.96445440427, 1644.75086719747, 1967.53727999066, 2290.32369278385, 2613.11010557704, 2935.89651837023,
      3258.68293116342, 3581.46934395661, 3904.2557567498,  4227.04216954299, 4549.82858233618, 4872.61499512937,
      5195.40140792256, 5518.18782071576, 5840.97423350895, 29.991666515561,  344.114910546964, 658.238154578366,
      972.361398609768, 1286.48464264117, 1600.60788667257, 1914.73113070398, 2228.85437473538, 2542.97761876678,
      2857.10086279818, 3171.22410682959, 3485.34735086099, 3799.47059489239, 4113.59383892379, 4427.7170829552,
      4741.8403269866,  5055.963571018,   5370.0868150494,  5684.21005908081, 29.1730845621415, 334.722759712992,
      640.272434863842, 945.822110014692, 1251.37178516554, 1556.92146031639, 1862.47113546724, 2168.02081061809,
      2473.57048576894, 2779.12016091979, 3084.66983607064, 3390.21951122149, 3695.76918637234, 4001.31886152319,
      4306.86853667404, 4612.41821182489, 4917.96788697574, 5223.5175621266,  5529.06723727745, 28.362755623661,
      325.425301366216, 622.48784710877,  919.550392851325, 1216.61293859388, 1513.67548433643, 1810.73803007899,
      2107.80057582154, 2404.8631215641,  2701.92566730665, 2998.98821304921, 3296.05075879176, 3593.11330453432,
      3890.17585027687, 4187.23839601943, 4484.30094176198, 4781.36348750453, 5078.42603324709, 5375.48857898964,
      27.5603864089927, 316.219170376863, 604.877954344734, 893.536738312604, 1182.19552228048, 1470.85430624835,
      1759.51309021622, 2048.17187418409, 2336.83065815196, 2625.48944211983, 2914.1482260877,  3202.80701005557,
      3491.46579402344, 3780.12457799131, 4068.78336195918, 4357.44214592705, 4646.10092989492, 4934.75971386279,
      5223.41849783066, 26.765691687993,  307.10109410434,  587.436496520688, 867.771898937035, 1148.10730135338,
      1428.44270376973, 1708.77810618608, 1989.11350860242, 2269.44891101877, 2549.78431343512, 2830.11971585147,
      3110.45511826781, 3390.79052068416, 3671.12592310051, 3951.46132551685, 4231.7967279332,  4512.13213034955,
      4792.4675327659,  5072.80293518225};

  auto brakeMap = brake->mutable_brakemap();

  brakeMap->set_comment("brake map, brake torque[Nm] vs brake pressure[bar] and wheel speed[rpm]");
  brakeMap->set_disp_name("brake map");

  auto y0Axis = brakeMap->mutable_y0_axis();
  y0Axis->set_unit("Nm");
  y0Axis->set_disp_name("brake torque");
  y0Axis->set_comment("brake torque on wheel due to brake pressure");
  for (auto i = 0; i < 380; ++i) {
    y0Axis->add_data(brakeMapData[i]);
  }

  auto u0Axis = brakeMap->mutable_u0_axis();
  tx_car::setRealAxis(u0Axis, "brake pressure", "brake pressure on wheel", "Bar", brakeMapPressure, 19);

  auto u1Axis = brakeMap->mutable_u1_axis();
  tx_car::setRealAxis(u1Axis, "wheel speed", "wheel speed used in brake map", "RPM", brakeMapWheelSpeed, 20);

  /*
  tx_car::setRealScalar(brake->mutable_rm(), "Brake_Pad_Radius", "Brake pad mean radius", "m", 0.177);
  tx_car::setRealScalar(brake->mutable_num_pads(), "Num_Pads", "Number of brake pads", "[]", 2);
  */
  tx_car::setRealScalar(brake->mutable_max_main_cylinder_pressure(), "Max_CylinderPressure",
                        "max brake main cylinder pressure", "Pa", 10e6);
  tx_car::setRealScalar(brake->mutable_rear_brk_pressure_ratio(), "Rear_BrakePressureRatio",
                        "Rear brake pressure ratio", "N/A", 0.4286);
  tx_car::setRealScalar(
      brake->mutable_const_fluid_time_front(), "Const_FliudDynamic_Front",
      "Const time of brake fluid dynamic, brake pressure will reach 95% of max at 3rd of this const time", "s", 0.06);
  tx_car::setRealScalar(
      brake->mutable_const_fluid_time_rear(), "Const_FliudDynamic_Rear",
      "Const time of brake fluid dynamic, brake pressure will reach 95% of max at 3rd of this const time", "s", 0.06);
  tx_car::setRealScalar(brake->mutable_const_fluid_transport_time_front(), "Const_FliudDynamicTransport_Front",
                        "Const time of brake fluid from brake input to brake actuators", "s", 0.0);
  tx_car::setRealScalar(brake->mutable_const_fluid_transport_time_rear(), "Const_FliudDynamicTransport_Rear",
                        "Const time of brake fluid from brake input to brake actuators", "s", 0.0);
}
