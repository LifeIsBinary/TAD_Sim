// Copyright 2024 Tencent Inc. All rights reserved.
//

#include "inc/writer_steermapped.h"
#include "inc/car_log.h"
#include "inc/proto_helper.h"

void SteerMappedWriter::fillMappedSteer(tx_car::car &m_car) {
  tx_car::SteerMapped *steer_mapped = m_car.mutable_steer_system()->mutable_steermapped();

  tx_car::setRealScalar(steer_mapped->mutable_steernaturalfreuency(), "SteerNaturalFrequency",
                        "steer natural frequency", "HZ", 16.1097);
  tx_car::setRealScalar(steer_mapped->mutable_steerdampingratio(), "SteerDampingRatio", "steer damping ratio(0,1)",
                        "N/A", 0.4705);

  real_T steer_angle[] = {-15.9957680616028290, -15.139160464724013, -14.389541550992451,
                          -13.7242220401322110, -13.127493968875347, -12.587838164158704,
                          -12.0963534467971010, -11.646058499782562, -11.23136826950871,
                          -10.8480939657707540, -10.492221331289111, -10.160783306335388,
                          -9.85116189703159330, -9.561088175350136,  -9.288642279113823,
                          -9.03207887907065480, -8.7901762447442415, -8.5615381127329844,
                          -8.34494275256048820, -8.1396920325259536, -7.9445642221529891,
                          -7.75903572266599180, -7.5822338694389657, -7.4136350636963142,
                          -7.25254117373723690, -7.0986031337113369, 0.0,
                          7.0986031337113369,   7.25254117373723690, 7.4136350636963142,
                          7.5822338694389657,   7.75903572266599180, 7.9445642221529891,
                          8.1396920325259536,   8.34494275256048820, 8.5615381127329844,
                          8.7901762447442415,   9.03207887907065480, 9.288642279113823,
                          9.561088175350136,    9.8511618970315933,  10.1607833063353880,
                          10.492221331289111,   10.848093965770754,  11.231368269508710,
                          11.646058499782562,   12.096353446797101,  12.5878381641587040,
                          13.127493968875347,   13.724222040132211,  14.3895415509924510,
                          15.139160464724013,   15.995768061602829};
  real_T rack_disp[] = {-86.360, -83.038, -79.963, -77.107, -74.448, -71.967, -69.645,  -67.469,  -65.4240,
                        -63.5,   -61.686, -59.972, -58.351, -56.816, -55.359, -53.975,  -52.6590, -51.405,
                        -50.209, -49.068, -47.978, -46.935, -45.936, -44.979, -44.0610, -43.18,   0.0,
                        43.18,   44.061,  44.979,  45.936,  46.935,  47.978,  49.068,   50.2090,  51.405,
                        52.659,  53.975,  55.359,  56.816,  58.351,  59.972,  61.686,   63.5,     65.4240,
                        67.469,  69.645,  71.967,  74.448,  77.107,  79.963,  83.038,   86.36};

  tx_car::set1DMapInfo(steer_mapped->mutable_rackdisp_vs_steerang(), "Rack displacement vs steer angle", "");
  tx_car::setRealAxis(steer_mapped->mutable_rackdisp_vs_steerang()->mutable_u0_axis(), "Steer_Angle", "steer angle",
                      "rad", steer_angle, 53);
  tx_car::setRealAxis(steer_mapped->mutable_rackdisp_vs_steerang()->mutable_y0_axis(), "Rack_Displacement",
                      "rack displacement", "mm", rack_disp, 53);

  real_T left_whl[] = {-0.779203263825151590, -0.7409345058357546,  -0.70747650218712121,
                       -0.67777165368931180,  -0.6510887717564301,  -0.62689814459717252,
                       -0.604801986542268470, -0.584492948950166,   -0.56572799768958493,
                       -0.548311230373029760, -0.53208216345218118, -0.51690750176874112,
                       -0.502675205831239920, -0.48929011854352988, -0.47667068066966511,
                       -0.464746418257910850, -0.45345599555143046, -0.44274568241466822,
                       -0.432568135569933230, -0.42288141667516238, -0.41364819575564932,
                       -0.404835097578239930, -0.39641216042473093, -0.38835238684412088,
                       -0.380631365614293730, -0.373226952870365,   0.0,
                       0.45794923261335435,   0.468869590366007620, 0.48032972906348487,
                       0.49237099939549028,   0.505039111709666420, 0.51838473134340246,
                       0.53246417378847477,   0.547340222377802110, 0.56308309432518611,
                       0.57977158880289315,   0.597494459643111760, 0.61635206659395714,
                       0.63645837756118928,   0.657943416956087930, 0.68095628633678873,
                       0.7056689323996056,    0.7322809059683020,   0.76102546157076056,
                       0.79217750689012745,   0.826064185568732180, 0.863079314746192,
                       0.90370369615405022,   0.948534785665861470, 0.99833211723630522,
                       1.0540910760488047,    1.1171721225188114};
  tx_car::set1DMapInfo(steer_mapped->mutable_leftwhl_vs_rackdisp(), "Left wheel angle vs rack displacement", "");
  tx_car::setRealAxis(steer_mapped->mutable_leftwhl_vs_rackdisp()->mutable_u0_axis(), "Rack_Displacement",
                      "rack displacement", "mm", rack_disp, 53);
  tx_car::setRealAxis(steer_mapped->mutable_leftwhl_vs_rackdisp()->mutable_y0_axis(), "LeftWheel_Angle",
                      "left wheel angle", "rad", left_whl, 53);

  real_T right_whl[] = {-1.11717212251881140,  -1.0540910760488047,  -0.99833211723630522,
                        -0.948534785665861470, -0.90370369615405022, -0.863079314746192,
                        -0.826064185568732180, -0.79217750689012745, -0.76102546157076056,
                        -0.7322809059683020,   -0.7056689323996056,  -0.68095628633678873,
                        -0.657943416956087930, -0.63645837756118928, -0.61635206659395714,
                        -0.597494459643111760, -0.57977158880289315, -0.56308309432518611,
                        -0.547340222377802110, -0.53246417378847477, -0.51838473134340246,
                        -0.505039111709666420, -0.49237099939549028, -0.48032972906348487,
                        -0.468869590366007620, -0.45794923261335435, 0.0,
                        0.373226952870365,     0.380631365614293730, 0.38835238684412088,
                        0.39641216042473093,   0.404835097578239930, 0.41364819575564932,
                        0.42288141667516238,   0.432568135569933230, 0.44274568241466822,
                        0.45345599555143046,   0.464746418257910850, 0.47667068066966511,
                        0.48929011854352988,   0.502675205831239920, 0.51690750176874112,
                        0.53208216345218118,   0.548311230373029760, 0.56572799768958493,
                        0.584492948950166,     0.604801986542268470, 0.62689814459717252,
                        0.6510887717564301,    0.67777165368931180,  0.70747650218712121,
                        0.7409345058357546,    0.77920326382515159};
  tx_car::set1DMapInfo(steer_mapped->mutable_rightwhl_vs_rackdisp(), "Right wheel angle vs rack displacement", "");
  tx_car::setRealAxis(steer_mapped->mutable_rightwhl_vs_rackdisp()->mutable_u0_axis(), "Rack_Displacement",
                      "rack displacement", "mm", rack_disp, 53);
  tx_car::setRealAxis(steer_mapped->mutable_rightwhl_vs_rackdisp()->mutable_y0_axis(), "RightWheel_Angle",
                      "right wheel angle", "rad", right_whl, 53);

  real_T veh_speed[8] = {-1.0, 0.0, 7, 16.89, 22.22, 27.0, 33.0, 40.0};
  real_T speed_coeff[8] = {1.0, 1.0, 0.8, 0.8, 0.7, 0.7, 0.6, 0.6};
  tx_car::set1DMapInfo(steer_mapped->mutable_vehiclespeedcoeff(), "Vehicle speed coefficient vs Vehicle Speed", "");
  tx_car::setRealAxis(steer_mapped->mutable_vehiclespeedcoeff()->mutable_u0_axis(), "Vehicle_Speed", "vehicle speed",
                      "m/s", veh_speed, 8);
  tx_car::setRealAxis(steer_mapped->mutable_vehiclespeedcoeff()->mutable_y0_axis(), "Vehicle_Speed_Coefficient",
                      "vehicle speed coefficient", "[]", speed_coeff, 8);
}
